<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui">

    <h:head>
        <title>Gestión de Usuarios - Skatelife Admin</title>
        <h:outputStylesheet library="css" name="admin.css"/>
    </h:head>

    <h:body>
        <div class="admin-container">

            <!-- Sidebar -->
            <div class="sidebar">
                <h2>Skatelife Admin</h2>

                <ul class="menu">
                    <li>
                        <h:link value="Panel" outcome="/admin/panel_admin"/>
                    </li>
                    <li>
                        <h:link value="Productos" outcome="/admin/productos"/>
                    </li>
                    <li>
                        <h:link value="Reportes" outcome="/admin/reportes"/>
                    </li>
                    <li class="active">
                        <h:link value="Usuarios" outcome="/admin/usuarios"/>
                    </li>
                </ul>
            </div>

            <!-- Contenido principal -->
            <div class="main-content">
                <h:form id="formUsuarios">
                    <p:growl id="messages" showDetail="true"/>

                    <!-- Encabezado -->
                    <div class="page-header">
                        <h1>Gestión de Usuarios</h1>
                        <p:commandButton value="Nuevo Usuario"
                                         icon="pi pi-plus"
                                         styleClass="btn-primary"
                                         onclick="PF('dialogNuevoUsuario').show()"
                                         type="button"/>
                    </div>

                    <!-- Estadísticas rápidas -->
                    <div class="stats-grid">
                        <div class="stat-card">
                            <i class="pi pi-users"></i>
                            <div class="stat-info">
                                <h3>#{usuarioBean.usuarios.size()}</h3>
                                <p>Total Administradores</p>
                            </div>
                        </div>
                    </div>

                    <!-- Filtros -->
                    <p:panel header="Búsqueda de Usuarios" styleClass="filter-panel">
                        <div class="p-grid">
                            <div class="p-col-12 p-md-6">
                                <p:inputText id="busqueda"
                                             value="#{usuarioBean.busqueda}"
                                             placeholder="Buscar por nombre, correo o username"
                                             style="width: 100%">
                                    <p:ajax event="keyup"
                                            update="tablaUsuarios"
                                            listener="#{usuarioBean.aplicarFiltros}"/>
                                </p:inputText>
                            </div>

                            <div class="p-col-12 p-md-2">
                                <p:commandButton value="Limpiar"
                                                 icon="pi pi-filter-slash"
                                                 update="tablaUsuarios busqueda"
                                                 action="#{usuarioBean.limpiarFiltros}"
                                                 styleClass="ui-button-secondary"/>
                            </div>
                        </div>
                    </p:panel>

                    <!-- Tabla -->
                    <p:dataTable id="tablaUsuarios"
                                 value="#{usuarioBean.usuarios}"
                                 var="usuario"
                                 paginator="true"
                                 rows="10"
                                 rowsPerPageTemplate="10,20,50"
                                 emptyMessage="No se encontraron usuarios">

                        <p:column headerText="ID" sortBy="#{usuario.id}" style="width: 60px">
                            <h:outputText value="#{usuario.id}"/>
                        </p:column>

                        <p:column headerText="Username" sortBy="#{usuario.username}">
                            <h:outputText value="#{usuario.username}"/>
                        </p:column>

                        <p:column headerText="Nombre" sortBy="#{usuario.nombre}">
                            <h:outputText value="#{usuario.nombre}"/>
                        </p:column>

                        <p:column headerText="Apellido" sortBy="#{usuario.apellido}">
                            <h:outputText value="#{usuario.apellido}"/>
                        </p:column>

                        <p:column headerText="Correo" sortBy="#{usuario.correo}">
                            <h:outputText value="#{usuario.correo}"/>
                        </p:column>

                        <p:column headerText="Celular">
                            <h:outputText value="#{usuario.celular}"/>
                        </p:column>

                        <p:column headerText="Rol" style="width: 120px">
                            <span class="badge badge-ADMIN">ADMIN</span>
                        </p:column>

                        <p:column headerText="Estado" style="width: 100px">
                            <span class="badge badge-activo">Activo</span>
                        </p:column>

                        <p:column headerText="Acciones" style="width: 140px; text-align: center">
                            <p:commandButton icon="pi pi-pencil"
                                             title="Editar"
                                             styleClass="ui-button-warning"
                                             action="#{usuarioBean.prepararEdicion(usuario)}"
                                             update=":formEditar"
                                             onclick="PF('dialogEditarUsuario').show()"/>

                            <p:commandButton icon="pi pi-trash"
                                             title="Eliminar"
                                             styleClass="ui-button-danger"
                                             action="#{usuarioBean.eliminarUsuario(usuario)}"
                                             update="tablaUsuarios messages">
                                <p:confirm header="Confirmación"
                                           message="¿Está seguro de eliminar este usuario?"
                                           icon="pi pi-exclamation-triangle"/>
                            </p:commandButton>
                        </p:column>
                    </p:dataTable>

                    <!-- DIÁLOGOS (no modificados porque estaban bien) -->
                    <!-- ... -->
                </h:form>
            </div>
        </div>
    </h:body>
</html>
